<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Conexi√≥n Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #2196F3;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #1976D2;
        }
        .log {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        .warning { color: #FF9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Test de Conexi√≥n Firebase</h1>
        <p>Este script probar√° la conexi√≥n y permisos de Firebase paso a paso.</p>
        
        <button onclick="testConexion()">Test Conexi√≥n B√°sica</button>
        <button onclick="testLectura()">Test Lectura</button>
        <button onclick="testEscritura()">Test Escritura</button>
        <button onclick="testCompleto()">Test Completo</button>
        <button onclick="limpiarLog()">Limpiar Log</button>
        
        <div id="log" class="log">
            <div class="info">Presiona cualquier bot√≥n para comenzar las pruebas...</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, collection, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Configuraci√≥n de Firebase (CREDENCIALES CORRECTAS)
        const firebaseConfig = {
            apiKey: "AIzaSyDwhMZaJWHcsgM2DE9v-hhVqM4IscTo4Kk",
            authDomain: "my-pagina-web-3aca7.firebaseapp.com",
            databaseURL: "https://my-pagina-web-3aca7-default-rtdb.firebaseio.com",
            projectId: "my-pagina-web-3aca7",
            storageBucket: "my-pagina-web-3aca7.firebasestorage.app",
            messagingSenderId: "677277617824",
            appId: "1:677277617824:web:e1b42b87b038a2690203c5",
            measurementId: "G-HDYB37KYET"
        };

        let app, db;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        window.limpiarLog = () => {
            document.getElementById('log').innerHTML = '<div class="info">Log limpiado...</div>';
        };

        window.testConexion = async () => {
            try {
                log('üöÄ Iniciando test de conexi√≥n b√°sica...', 'info');
                
                // Inicializar Firebase
                app = initializeApp(firebaseConfig);
                log('‚úÖ Firebase App inicializada correctamente', 'success');
                
                // Inicializar Firestore
                db = getFirestore(app);
                log('‚úÖ Firestore inicializado correctamente', 'success');
                
                log('üéâ Conexi√≥n b√°sica exitosa', 'success');
                
            } catch (error) {
                log(`‚ùå Error en conexi√≥n b√°sica: ${error.message}`, 'error');
                console.error('Error completo:', error);
            }
        };

        window.testLectura = async () => {
            try {
                if (!db) {
                    await testConexion();
                }
                
                log('üìñ Iniciando test de lectura...', 'info');
                
                // Intentar leer la colecci√≥n productos
                const productosRef = collection(db, 'productos');
                const snapshot = await getDocs(productosRef);
                
                log(`‚úÖ Lectura exitosa: ${snapshot.size} documentos encontrados`, 'success');
                
                if (snapshot.size > 0) {
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        log(`  üìÑ Doc ID: ${doc.id} - ${data.nombre || 'Sin nombre'}`, 'info');
                    });
                } else {
                    log('‚ö†Ô∏è No hay documentos en la colecci√≥n productos', 'warning');
                }
                
            } catch (error) {
                log(`‚ùå Error en lectura: ${error.code} - ${error.message}`, 'error');
                console.error('Error completo:', error);
            }
        };

        window.testEscritura = async () => {
            try {
                if (!db) {
                    await testConexion();
                }
                
                log('‚úèÔ∏è Iniciando test de escritura...', 'info');
                
                const testId = 'test-' + Date.now();
                const testRef = doc(db, 'test-conexion', testId);
                
                // Intentar escribir un documento de prueba
                await setDoc(testRef, {
                    timestamp: new Date().toISOString(),
                    test: 'escritura-exitosa',
                    mensaje: 'Este es un test de escritura'
                });
                
                log('‚úÖ Escritura exitosa', 'success');
                
                // Verificar que se escribi√≥ correctamente
                const docSnap = await getDoc(testRef);
                if (docSnap.exists()) {
                    log('‚úÖ Verificaci√≥n de escritura exitosa', 'success');
                    
                    // Limpiar el documento de prueba
                    await deleteDoc(testRef);
                    log('üßπ Documento de prueba eliminado', 'info');
                } else {
                    log('‚ùå Error: El documento no se escribi√≥ correctamente', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Error en escritura: ${error.code} - ${error.message}`, 'error');
                
                if (error.code === 'permission-denied') {
                    log('üîí Error de permisos. Verifica las reglas de Firestore:', 'error');
                    log('   - Ve a Firebase Console > Firestore > Rules', 'info');
                    log('   - Aseg√∫rate de que las reglas permitan lectura/escritura', 'info');
                }
                
                console.error('Error completo:', error);
            }
        };

        window.testCompleto = async () => {
            log('üîÑ Ejecutando test completo...', 'info');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            
            await testConexion();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testLectura();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testEscritura();
            
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('üèÅ Test completo finalizado', 'info');
        };

        // Auto-ejecutar test b√°sico al cargar
        setTimeout(() => {
            testConexion();
        }, 1000);
    </script>
</body>
</html>